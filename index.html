<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>떡잎방범대 주식 센터</title>
<style>
body { font-family: Arial, sans-serif; background:#0f172a; color:#e5e7eb; margin:0; padding:20px; }
h1 { text-align:center; }
#userInfo,#depositSection,#log { margin:20px auto; max-width:800px; }
#companies { display:grid; grid-template-columns:repeat(2,1fr); gap:10px; margin:20px auto; max-width:800px; }
.company { padding:10px; background:#1f2937; border-radius:8px; display:flex; justify-content:space-between; align-items:flex-start; gap:10px; }
.company div { flex:1; }
button { padding:5px 10px; cursor:pointer; margin-top:4px; }
#log { max-height:220px; overflow-y:auto; background:#111827; padding:10px; border-radius:8px; }
canvas { background:#111827; border-radius:8px; display:block; margin:20px auto; }
#loginModal { display:flex; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; }
#loginModalContent { background:#1f2937; padding:20px; border-radius:10px; text-align:center; }
#loginModal input { margin:10px 0; padding:5px; width:80%; }
#adminSection { text-align:center; margin-top:20px; }
#adminSection input { padding:5px; }

/* 관리자 모달 */
#adminModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; }
#adminModalContent { background:#1f2937; padding:20px; border-radius:10px; width:520px; max-height:85%; overflow:auto; position:relative; }
#adminModalContent h2 { margin:10px 0; }
.requestBox { margin-bottom:10px; padding:10px; background:#111827; border-radius:6px; }
#adminModalContent .closeBtn { position:absolute; top:10px; right:10px; background:none; border:none; color:#e5e7eb; font-size:18px; cursor:pointer; }
.graphRow { display:flex; align-items:center; gap:8px; padding:8px; background:#111827; border-radius:6px; margin-bottom:8px; }
.graphRow .name { width:110px; font-weight:bold; }
.graphRow input[type="number"] { width:120px; padding:4px; text-align:right; }
.graphControls { display:flex; gap:8px; margin:8px 0 12px; }
.small { font-size:12px; color:#9ca3af; }
hr { border:0; border-top:1px solid #374151; margin:14px 0; }
</style>
</head>
<body>
<h1>인게임 주식 시뮬레이터</h1>

<div id="userInfo"></div>
<div id="depositSection">
  <input type="text" id="accountNumber" placeholder="계좌번호 입력">
  <input type="number" id="depositAmount" placeholder="금액 입력">
  <button id="depositBtn">추가 요청</button>
</div>

<div id="companies"></div>
<canvas id="chart" width="800" height="400"></canvas>
<div id="log"></div>

<!-- 로그인 모달 -->
<div id="loginModal">
  <div id="loginModalContent">
    <h2>거래 시작 전 정보 입력</h2>
    <input type="text" id="userId" placeholder="고유번호 입력" /><br>
    <input type="text" id="userName" placeholder="이름 입력" /><br>
    <button id="startBtn">시작</button>
  </div>
</div>

<!-- 관리자 섹션 -->
<div id="adminSection">
  <input type="text" id="adminCode" placeholder="관리자 코드 입력 (ADMIN123 / SEED123)">
  <button onclick="checkAdminCode()">실행</button>
</div>

<!-- 관리자 요청 & 그래프 제어 모달 -->
<div id="adminModal">
  <div id="adminModalContent">
    <button class="closeBtn" onclick="closeAdminModal()">✖</button>
    <h2>입금 요청 관리</h2>
    <div id="requestsList"></div>

    <hr>
    <h2>그래프 제어(중앙)</h2>
    <div class="small">한 명의 관리자만 시작하세요. 모든 유저는 Firestore 구독으로 동일 그래프를 보게 됩니다.</div>
    <div class="graphControls">
      <button id="startGraphBtn">시작(중앙 랜덤 변동)</button>
      <button id="stopGraphBtn">중지</button>
    </div>
    <div id="graphControl"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="module">
// Firebase imports
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import {
  getFirestore, doc, getDoc, setDoc, updateDoc,
  collection, addDoc, getDocs, deleteDoc, onSnapshot, serverTimestamp
} from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCQf-ofDMSTwOBsopBsx5ZXCy1XhIWLeVY",
  authDomain: "cotyledons-of-stock.firebaseapp.com",
  projectId: "cotyledons-of-stock",
  storageBucket: "cotyledons-of-stock.appspot.com",
  messagingSenderId: "343488842605",
  appId: "1:343488842605:web:f4c1205568f5994d55e864",
  measurementId: "G-YB960D84W4"
};
const app = initializeApp(firebaseConfig);
const db  = getFirestore(app);

/* === 생략: 로그인, 기업 구독, 입금 요청, 관리자 승인/거절, 그래프 제어 로직 === */
/* 위에서 설명드린 로직이 그대로 포함됩니다. */
</script>
</body>
</html>
