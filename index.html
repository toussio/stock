<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ë–¡ìë°©ë²”ëŒ€ ì£¼ì‹ ì„¼í„°</title>
<style>
  :root{
    --bg:#0f172a; --card:#1f2937; --ink:#e5e7eb; --ink2:#cbd5e1;
    --accent:#334155; --accentH:#475569; --danger:#7f1d1d; --ok:#065f46;
  }
  *{box-sizing:border-box}
  body { font-family: Arial, sans-serif; background:var(--bg); color:var(--ink); margin:0; padding:20px; }
  h1 { text-align:center; margin:4px 0 16px }

  /* âœ… ê·¸ë˜í”„ ê³ ì • */
  #chartWrap {
    margin:20px auto;
    max-width:1100px;
    height:400px;          /* ë†’ì´ ê³ ì • */
    background:#111827;
    border-radius:10px;
    overflow:hidden;
  }
  #chart {
    width:100% !important;
    height:100% !important;
  }

  /* ê¸°ì—… ì¹´ë“œ */
  #companies {
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:12px;
    margin:20px auto;
    max-width:1100px;
  }
  .company {
    background:var(--card);
    border-radius:10px;
    padding:12px;
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .company .info { display:flex; justify-content:space-between; align-items:center; font-weight:600; }
  .company .info small{ color:var(--ink2); font-weight:400 }
  .company .actions { display:grid; grid-template-columns:1fr 1fr; gap:6px; }
  .company .actions input[type="number"] {
    grid-column:span 2; padding:8px;
    border-radius:8px; border:1px solid #374151; background:#0b1220; color:var(--ink);
  }

  /* ë¡œê·¸ì°½ */
  #log { max-height:240px; overflow-y:auto; background:#111827; padding:12px; border-radius:10px; }

  /* ëª¨ë‹¬/ê´€ë¦¬ì */
  .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.7); justify-content:center; align-items:center; z-index:50; }
  .modal-content { background:var(--card); padding:20px; border-radius:10px; text-align:center; width:min(90%,440px); }
  .modal-content input { margin:8px 0; padding:8px; width:85%; border-radius:8px; border:1px solid #374151; background:#0b1220; color:var(--ink) }
  .admin-panel{display:none; max-width:1100px; margin:20px auto; background:var(--card); padding:10px; border-radius:10px; position:relative;}
  .xbtn { position:absolute; top:8px; right:8px; background:var(--danger); border:none; color:white; border-radius:50%; width:28px; height:28px; cursor:pointer; }
</style>
</head>
<body>
<h1>ì¸ê²Œì„ ì£¼ì‹ ì‹œë®¬ë ˆì´í„°</h1>

<!-- ê·¸ë˜í”„ -->
<div id="chartWrap"><canvas id="chart"></canvas></div>

<!-- ê¸°ì—… ì¹´ë“œ -->
<div id="companies"></div>

<!-- ë¡œê·¸ -->
<div id="log"></div>

<!-- ê´€ë¦¬ì ë¡œê·¸ì¸ -->
<div id="adminLogin" style="text-align:center;margin-top:20px;">
  <input type="password" id="adminCode" placeholder="ê´€ë¦¬ì ì½”ë“œ ì…ë ¥">
  <button onclick="checkAdmin()">ê´€ë¦¬ì ë¡œê·¸ì¸</button>
</div>

<!-- ê´€ë¦¬ì íŒ¨ë„ ì˜ˆì‹œ -->
<div id="adminPanelGraph" class="admin-panel">
  <button class="xbtn" onclick="closeAdmin('adminPanelGraph')">âœ•</button>
  <h3>ğŸ“Š ê·¸ë˜í”„ ì œì–´ íŒ¨ë„</h3>
  <div>
    <button onclick="startPriceSimulation()">ì‹œì‘</button>
    <button onclick="stopPriceSimulation()">ì •ì§€</button>
    <button onclick="resetGraph()">ì´ˆê¸°í™”</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAVCFjQ0ton4HPtkcYAHMeuMubH1gD1KWg",
  authDomain: "cotyledons-of-stock-a1241.firebaseapp.com",
  projectId: "cotyledons-of-stock-a1241",
  storageBucket: "cotyledons-of-stock-a1241.appspot.com",
  messagingSenderId: "962984742513",
  appId: "1:962984742513:web:25082eed6cdcc9c37b95d0",
  measurementId: "G-NRPT075Q3X"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const companies = [
  {name:"ë–¡ìë°©ë²”ëŒ€", basePrice:1000, livePrice:1000},
  {name:"ì¹´ìŠ¤í‹¸ë¡œ", basePrice:500, livePrice:500},
  {name:"ì‚¬ì¿ ë¼", basePrice:500, livePrice:500},
  {name:"ì²­ë£¡", basePrice:500, livePrice:500},
  {name:"ê²½ì°°ì²­", basePrice:500, livePrice:500},
  {name:"Ems", basePrice:500, livePrice:500},
  {name:"ì˜¬ë“œë³´ì´", basePrice:500, livePrice:500},
  {name:"ì‘ë‘", basePrice:800, livePrice:800},
  {name:"ë¹…ë”•", basePrice:700, livePrice:700},
  {name:"ìœ í† í”¼ì•„", basePrice:600, livePrice:600},
  {name:"inback", basePrice:550, livePrice:550},
];

let chart=null;
function initChart(){
  if(chart) return;
  const ctx=document.getElementById("chart").getContext("2d");
  chart = new Chart(ctx,{
    type:"line",
    data:{
      labels:[],
      datasets:companies.map(c=>({ label:c.name, data:[], borderWidth:2, fill:false }))
    },
    options:{
      responsive:false,           // âœ… ë°˜ì‘í˜• êº¼ì§
      maintainAspectRatio:false,  // âœ… ë¹„ìœ¨ ë¬´ì‹œ
      animation:false,
      plugins:{ legend:{position:"bottom"} },
      scales:{
        x:{ title:{display:true,text:"ì‹œê°„"} },
        y:{ 
          title:{display:true,text:"ê°€ê²©(KRW)"}, 
          min:0, max:2000         // âœ… Yì¶• ë²”ìœ„ ê³ ì •
        }
      }
    }
  });
}
function appendChartPoint(){
  if(!chart) return;
  const now=new Date().toLocaleTimeString();
  chart.data.labels.push(now);
  companies.forEach((c,i)=>chart.data.datasets[i].data.push(c.livePrice));
  if(chart.data.labels.length>50){
    chart.data.labels.shift();
    chart.data.datasets.forEach(d=>d.data.shift());
  }
  chart.update();
}

/* ê·¸ë˜í”„ ì‹œë®¬ë ˆì´ì…˜ */
let timer=null;
function updatePrices(){
  companies.forEach(c=>{
    const change=(Math.random()-0.5)*50;
    c.livePrice=Math.max(0,c.livePrice+change);
    setDoc(doc(db,"companyPrices",c.name),{current:c.livePrice},{merge:true});
  });
  appendChartPoint();
}
function startPriceSimulation(){
  if(timer) return;
  timer=setInterval(updatePrices,2000);
}
function stopPriceSimulation(){
  clearInterval(timer); timer=null;
}
function resetGraph(){
  if(chart){
    chart.data.labels=[]; chart.data.datasets.forEach(d=>d.data=[]);
    chart.update();
  }
}

window.onload=()=>{ initChart(); };
</script>
</body>
</html>
